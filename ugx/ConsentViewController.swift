//
//  ConsentViewController.swift
//  ugx
//
//  Created by Austin Vershel on 8/3/16.
//  Copyright Â© 2016 Austin Vershel. All rights reserved.
//

import Foundation
import ResearchKit

class ConsentViewController: UIViewController {
    
    var index = 0;
    var role = 99;
    var gender = 99;
    var age = 99;
    var username = ""
    var pass = "";
    var email = "";
    var canceled = false;
    override func viewDidLoad() {
        super.viewDidLoad()
        // Do any additional setup after loading the view, typically from a nib.

        
    }
    
    override func viewDidAppear(animated: Bool) {
      
        if(index == 0){
            
        
        let taskViewController = ORKTaskViewController(task: ConsentTask, taskRunUUID: nil)
        taskViewController.delegate = self
        presentViewController(taskViewController, animated: true, completion: nil)
         index = 1;
        }
        else if(canceled == true){
            performSegueWithIdentifier("consenttosurvey", sender: nil)
        }
//        else{
//            performSegueWithIdentifier("consenttoregister", sender: nil)
//
        }
//    }
    
    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
        // Dispose of any resources that can be recreated.
    }
    

    

func postDataToURL() {
    
    // Setup the session to make REST POST call
    let postEndpoint: String = "https://ultragenyx-api-qa.nof1health.com/registration/register/participant"
    let url = NSURL(string: postEndpoint)!
    let session = NSURLSession.sharedSession()
    let postParams : [String: AnyObject] = ["Contact":["Email":"\(email)","FirstName":"firstName","MiddleName":"midName","LastName":"lastName","Phone":"2402402402"],"PreferredLanguage":["LanguageCode":"en","LanguageName":"English"],
                                            "BirthDate":"07/07/2010",
                                            "Address":["AddressLine1":"address line 1","AddressLine2":"address line 2","AddressLine3":"address line 3","Country":["Id":"a1d13697-a73d-4aca-9418-769ec5bf5059","CodeSetName":"CountryCode","CodeValue":"C17234","Description":"United States of America"],"StateProvince":["Id":"9e4595e6-77a5-4510-9019-aec81f29efb0","CodeSetName":"StateCode","CodeValue":"MD","Description":"Maryland"]],
                                            "Account":["UserName":"\(username)","Password":"\(pass)","SecurityQuestion":["Id":"0e6b491f-cd74-4a51-b5f9-1f915e9ab3c8","IsActive":true,"LanguageCode":"","LanguageName":"","Phrase":"What was the model of your first car?","PhraseDescription":"What was the model of your first car?","PhraseDescriptionTranslated":"What was the model of your first car?","PhraseTranslated":"What was the model of your first car?","SecurityQuestionGroupNumber":1],"SecurityAnswer":"ford"],
                                            "RegistrationType":["ApiType":"newParticipant","Key":"PARTICIPANT1"],
                                            "LegalStatements":[["Id":"f7ffb72f-98a6-460d-9a3f-28df8a187740","IsActive":true,"LanguageCode":"","LanguageName":"","StatementText":"\r\n    <h3>\r\n        Privacy Policy\r\n    </h3>\r\n    <div class=\"EnrollmentContentTable\">\r\n        <div class=\"divStep4DisplayHeader\">\r\n            <b>Where and how will my health information be stored?</b>\r\n            <ul>\r\n                <li>The health information that you enter for the GNEM-DMP registry will be entered into an international database, which is supervised by TREAT-NMD. </li>\r\n                <li>Your personal health information will be treated confidentially and will only be identified by an anonymous code, and not by your name.  </li>\r\n                <li>There are data protection measures in place to protect the information entered. </li>\r\n                <li>The personal and medical information collected will be stored on a secure server for up to 15 years. </li>\r\n            </ul>\r\n        </div>\r\n\r\n\r\n        <div class=\"divStep4DisplayHeader\">\r\n            <b>Who will have access to my anonymous health information?</b>\r\n            <ul>\r\n                <li>GNEM researchers or companies planning clinical trials on new therapies will only have access to the anonymous information identifiable by a code. </li>\r\n                <li>Only anonymous information will be provided to researchers for publication purposes. </li>\r\n                <li>A description of the GNEM-DMP is available on <a href=\"http://www.clinicaltrials.gov/ct2/show/NCT01784679\">www.clinicaltrials.gov</a>. </li>\r\n                <li>This website will not include information that can identify you. </li>\r\n                <li>         Your personal health information will not be made available to: </li>\r\n                <ul>\r\n                    <li>employers </li>\r\n                    <li>government organizations </li>\r\n                    <li>insurance companies or educational institutions  </li>\r\n                    <li>your spouse  </li>\r\n                    <li>members of your family  </li>\r\n                    <li>your doctor  </li>\r\n                </ul>\r\n            </ul>\r\n        </div>\r\n        You may download the <a href=\"http://www.treat-nmd.eu/about/site-updates/cookies-privacy\">TREAT-NMD privacy policy</a>  for more information.\r\n    </div>\r\n","StatementTextTranslated":"\r\n    <h3>\r\n        Privacy Policy\r\n    </h3>\r\n    <div class=\"EnrollmentContentTable\">\r\n        <div class=\"divStep4DisplayHeader\">\r\n            <b>Where and how will my health information be stored?</b>\r\n            <ul>\r\n                <li>The health information that you enter for the GNEM-DMP registry will be entered into an international database, which is supervised by TREAT-NMD. </li>\r\n                <li>Your personal health information will be treated confidentially and will only be identified by an anonymous code, and not by your name.  </li>\r\n                <li>There are data protection measures in place to protect the information entered. </li>\r\n                <li>The personal and medical information collected will be stored on a secure server for up to 15 years. </li>\r\n            </ul>\r\n        </div>\r\n\r\n\r\n        <div class=\"divStep4DisplayHeader\">\r\n            <b>Who will have access to my anonymous health information?</b>\r\n            <ul>\r\n                <li>GNEM researchers or companies planning clinical trials on new therapies will only have access to the anonymous information identifiable by a code. </li>\r\n                <li>Only anonymous information will be provided to researchers for publication purposes. </li>\r\n                <li>A description of the GNEM-DMP is available on <a href=\"http://www.clinicaltrials.gov/ct2/show/NCT01784679\">www.clinicaltrials.gov</a>. </li>\r\n                <li>This website will not include information that can identify you. </li>\r\n                <li>         Your personal health information will not be made available to: </li>\r\n                <ul>\r\n                    <li>employers </li>\r\n                    <li>government organizations </li>\r\n                    <li>insurance companies or educational institutions  </li>\r\n                    <li>your spouse  </li>\r\n                    <li>members of your family  </li>\r\n                    <li>your doctor  </li>\r\n                </ul>\r\n            </ul>\r\n        </div>\r\n        You may download the <a href=\"http://www.treat-nmd.eu/about/site-updates/cookies-privacy\">TREAT-NMD privacy policy</a>  for more information.\r\n    </div>\r\n","StatementType":["Id":"79fa0aa4-d402-4946-96f3-3dbe17ad4f5d","CodeSetName":"LegalStatementTypeCode","CodeValue":"PrivacyPolicy","Description":"PrivacyPolicy"],"IsAccepted":true],["Id":"0f1bd3fc-501a-44b9-b525-c0aa4fd7f085","IsActive":true,"LanguageCode":"","LanguageName":"","StatementText":"\r\n    <h3>\r\n        GNEM-DMP TERMS OF USE\r\n    </h3>\r\n    <div class=\"EnrollmentContentTable\">\r\n        <div class=\"tdTopPadding tdButtomPadding\">\r\n            [Last Updated:  August 20, 2015]\r\n        </div>\r\n        <div class=\"tdTopPadding tdButtomPadding\">\r\n            Welcome to the GNEM-DMP (&quot;the GNEM-DMP Platform&quot;), the web platform operated and hosted by Digital Infuzion, Inc. (&quot;Digital Infuzion&quot;). The GNEM-DMP incorporates both a reporting portal and a data entry component. These Terms of Use govern the access to and use of the GNEM-DMP.\r\n        </div>\r\n        <div class=\"tdTopPadding tdButtomPadding\">\r\n            The GNEM-DMP is for use by physicians and authorized medical personnel (the &quot;Participating Medical Personnel&quot;) and participants (&quot;Participants&quot;) who take part in registries, observational studies, or health outcome studies sponsored by Digital Infuzion&apos;s customer (&quot;Customer&quot;), as well as members of secondary care teams that provide care for Participants (&quot;Secondary Care Personnel&quot;) (collectively, &quot;Users&quot;).\r\n        </div>\r\n        <div class=\"tdTopPadding tdButtomPadding\">\r\n            RegistryNXT! is restricted-access: in accordance with these Terms of Use, only Participating Medical Personnel who are approved by Genzyme, and Secondary Care Personnel and Participants who are invited by Participating Medical Personnel, may register to access and use RegistryNXT!.  Registration for and use of RegistryNXT! by Users is entirely voluntary.\r\n        </div>\r\n        The primary purpose of the GNEM-DMP is to facilitate, in accordance with the Customer&apos;s observational outcomes or other study protocols, Participating Medical Personnel to collect, submit, and view data in connection with these studies. Participating Medical Personnel will have the ability to view pre-defined, real-time reports from this data and to share such individual reports with Secondary Care Personnel and Participants. Each class of User has different rights in relation to the GNEM-DMP:\r\n    </div>\r\n\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        Participating Medical Personnel may enter data on the GNEM-DMP, review and query data stored on the GNEM-DMP, and generate reports from the GNEM-DMP;\r\n    </div>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        Secondary Care Personnel may review reports relating to Participants, but only if published and shared by Participating Medical Personnel; and Participants may review customized reports generated and shared by Participating Medical Personnel and may view a list of Observational outcomes members who are part of the Participating Medical Personnel&apos;s team.\r\n    </div>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        Accordingly, these Terms of Use are divided into sections applicable to different classes of User.\r\n    </div>\r\n\r\n    </br>\r\n    <div class=\"divStep4DisplayHeader\">\r\n        <b><u>Terms Regarding Use of the GNEM-DMP Applicable to All Users </u></b>\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Registration and Privacy.</b>  Information that you provide to Digital Infuzion and its Customer about yourself when registering to use the GNEM-DMP must be accurate and truthful, and you accept any and all liability for any inaccurate or untruthful information that you provide, except that Participants may register with a fictitious name (or alias) in order to protect their privacy. Note that Secondary Care Personnel and Participants will need a valid e-mail address in order to register, as invitations will be sent from Participating Medical Personnel via e-mail, which will contain a personalized link for the invitee to click on in order to register. Accordingly, Digital Infuzion, the primary technical provider, and its agents, will have access to the e-mail addresses for all Users for the purpose of assistance with passwords and for the sending of system notification updates. Digital Infuzion respects the privacy of all Users, and you should refer to the Digital Infuzion Privacy Policy applicable to the GNEM-DMP to learn more about the collection and use of your personal information.\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>User Account, Password and Security.</b>  All Users, regardless of role, must register and select a username, password, and a security question. You are entirely responsible for maintaining the confidentiality of your ID, password and account, and for taking precautions to prevent the inadvertent disclosure of your ID, password or account information. Furthermore, you should not share your user ID or password, even with other members of your staff or practice (for Participating Medical Personnel and Secondary Care Personnel) or with family members or friends (for all Users). For Participating Medical Personnel and Secondary Care Personnel, each member of your staff or practice will need to be separately registered in the GNEM-DMP and obtain his/her own user ID and password. You are entirely responsible for any and all activities that occur under your account. You agree to notify Digital Infuzion immediately of any unauthorized use of your account or any other breach of security. Digital Infuzion will not be liable for any loss that you may incur as a result of someone else using your ID, password or account, either with or without your knowledge. You may be held liable for any harm or loss (including legal fees) incurred by Digital Infuzion or another party due to someone else using your ID, password or account. Digital Infuzion and its customer may suspend or terminate your access to the GNEM-DMP if Digital Infuzion believes your account is being used by an unauthorized person or if you have not complied with these Terms of Use or for any other reason in Digital Infuzion&apos;s sole discretion. You may not use anyone else&apos;s account at any time, without the express permission of the account holder.\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>E-signatures. </b> In order to become authorized to use the GNEM-DMP, you may be asked to furnish information that constitutes an electronic signature. You accept that your electronic signature is legally binding and equivalent to your written signature.\r\n    </div>\r\n    </br>\r\n    <div class=\"divStep4DisplayHeader\">\r\n        <b><u>Terms Regarding Use Applicable to Participating Medical Personnel </u></b>\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        Information Entered into the GNEM-DMP by Participating Medical Personnel. You may only enter information into the GNEM-DMP that relates to the studies, and you accept any and all liability for any optional information that you enter, for example, care team contacts or report comments. You are prohibited from entering any information that may breach applicable laws, including any data protection or privacy laws; Sections 5 (&quot;Data Privacy and Data Protection&quot;) and 10 (&quot;Third Party Consents&quot;) of these Terms of Use set out your obligations in this regard in more detail.\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Third Party Consents.</b> You may enter into the GNEM-DMP personal information relating to a Participant only after securing the freely-given explicit consent of the Participant to do so. Please note, in some jurisdictions including potentially your own, observational outcomes identification numbers might constitute personal information under applicable laws. When obtaining such consents, you must comply with any requirements arising under their local data privacy, health or related laws. This includes obtaining the Participant&apos;s written consent and providing Participants with suitable informational disclosures concerning the processing of their data in connection with the GNEM-DMP. It is a misuse of the GNEM-DMP and a violation of these Terms of Use to enter information relating to a Participant who has not expressly consented to having their personal data processed in connection with the GNEM-DMP. You are solely responsible for any and all information entered by you regarding Participants, and in no event shall Digital Infuzion be liable for any loss, harm or damage arising from or related to your failure to obtain necessary consents from Participants to have information relating to them entered into or processed in connection with the GNEM-DMP.\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Responsibility for Secondary Care Personnel and Participant use of the GNEM-DMP.  </b>  As a Participating Medical Personnel, you have the ability at your discretion to invite Secondary Care Personnel and your Participants to register in the GNEM-DMP. Secondary Care Personnel and Participants will only have access to customized reports specifically created and designated by you. You are solely responsible for verifying the identity of such invitees and for the disclosure of the Participant data to Secondary Care Personnel and to the Participants themselves, including any liability related to the disclosure of such data to the extent disclosure is not permissible under local law. For system performance, Digital Infuzion and its Customer may monitor access to particular Participant data stored on the GNEM-DMP by user ID and may perform audits on such access.\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Exclusion of Liability. </b>  Any information and material entered by Participating Medical Personnel into the GNEM-DMP is done at your own discretion and risk and you will be solely responsible for any damage to your computer system or loss, temporary or permanent, of data that results from the input of any such information or material or otherwise from using the GNEM-DMP.\r\n    </div>\r\n    </br>\r\n    <div class=\"divStep4DisplayHeader\">\r\n        <b><u>Disclaimers, Exclusions and Other Important Terms Applicable to All Users </u></b>\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Disclaimer of Warranties. </b>  The GNEM-DMP is provided on an \"AS IS\" and \"AS AVAILABLE\" basis. You agree that your access to and use of the GNEM-DMP and the contents available therein is at your own risk.\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        Although Digital Infuzion will use reasonable efforts to ensure that the GNEM-DMP remains operational and accessible to Users, by registering for and using the GNEM-DMP you accept that Digital Infuzion makes no express or implied warranties or representations of any kind as to the accuracy, content, completeness, reliability, operability, or legality of information contained within the GNEM-DMP; or that the GNEM-DMP will meet your particular business requirements, needs or expectations; or that the GNEM-DMP will be uninterrupted, timely, error-free or continuously available; or that the GNEM-DMP will not cause you any loss, interruption of business, interruption of research or treatment, or any direct, indirect, special, incidental or consequential damages of any kind (including lost profits) regardless of the form of the action whether in contract or in tort (including negligence).\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Damages. </b>Any use that you make of information stored within the GNEM-DMP or generated in reports is done at your own discretion and risk. Neither Digital Infuzion, nor any party involved in creating, producing or delivering the GNEM-DMP, shall be liable for any damages, including without limitation, direct, indirect, special, incidental or consequential damages of any kind (including lost profits) regardless of the form of the action whether in contract or in tort (including negligence), arising out of access to, use of or inability to use the GNEM-DMP, or regarding any use of information stored within the GNEM-DMP or generated in reports.\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Non-Confidential Information. </b> Subject to any protections that might be extended under the Digital Infuzion Privacy Policy applicable to the GNEM-DMP, any communication that you send to Digital Infuzion via the Internet is and will be deemed to be non-confidential and Digital Infuzion shall have no obligation of any kind with respect to such information, except as contained in the applicable observational outcomes protocol. Digital Infuzion shall be free to use any ideas, concepts, know-how or techniques contained in such communication for any purpose whatsoever, including but not limited to, researching, developing, testing, manufacturing and marketing products.\r\n    </div>\r\n    </br>\r\n    <div class=\"divStep4DisplayHeader\">\r\n        <b><u>Disclaimers, Exclusions and Other Important Terms Applicable to All Users</u></b>\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Trademarks </b> All product names with or without the trademark symbol, are registered trademarks, trademarks or trade names of Digital Infuzion, its Customers, affiliates, related companies, licensors or joint venture partners, unless otherwise noted. The use of these trademarks or any other materials, except as permitted herein, is expressly prohibited and may be in violation of copyright law, trademark law or other proprietary rights of Digital Infuzion.\r\n    </div>\r\n    </br>\r\n\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Copyrights. </b> The contents of the GNEM-DMP are subject to copyright protection and all rights therein are reserved to Digital Infuzion. The contents of the GNEM-DMP may not be copied other than for non-commercial individual reference with all copyright or other proprietary notices retained, and thereafter may not be recopied, reproduced or otherwise redistributed except where necessary in connection with your professional activities and related research endeavours. Except as expressly provided above, you may not otherwise copy, display, download, distribute, modify, reproduce, republish or retransmit any information, text or documents or any portion thereof in any electronic medium or in hard copy, or create any derivative work based on such images, text or documents, without the express written consent of Digital Infuzion. Nothing contained herein shall be construed as conferring by implication, estoppel or otherwise any license or right under any patent or trademark of Digital Infuzion, or any third party.\r\n    </div>\r\n    </br>\r\n\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Void Where Prohibited. </b> The GNEM-DMP and its contents are intended to comply with the laws and regulations of the State of Maryland, United States. Other countries may have laws, regulatory requirements and medical practices that differ from those in the State of Maryland, United States. Digital Infuzion and its Customer reserve the right to limit use of the GNEM-DMP to any person, geographic region or jurisdiction.\r\n    </div>\r\n    </br>\r\n\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Third Party Web Sites. </b> The GNEM-DMP contains links to other World Wide Web sites and resources produced by Digital Infuzion and its Customers various operating divisions and affiliates, as well as independent third parties unaffiliated with Digital Infuzion. Such links are provided for your reference only. Digital Infuzion does not control such web sites, and is not responsible for their contents. Digital Infuzion&apos;s inclusion of links to such web sites does not imply any endorsement of the material on such web sites or any association with their operators, and your access and use of such web sites, including information, material, products and services therein, is solely at your own risk. Digital Infuzion makes no representation or warranty as to any third party content, products or services, and you agree that Digital Infuzion shall not be responsible or liable, directly or indirectly, for any damage or loss caused or alleged to be caused by or in connection with use of or reliance on any such third-party content, products or services available on or through any such site or resource. Once on another web site, you should read that web site&apos;s privacy policy before disclosing any personal information.\r\n    </div>\r\n    </br>\r\n\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Software Use. </b> Use of the GNEM-DMP may entail your installing, copying, downloading, accessing or otherwise using software products owned by or proprietary to Digital Infuzion or its licensors (the &quot;Software&quot;). Users are authorized to install, use, access, display or run the Software only in connection with their use of the GNEM-DMP, and for no other purpose. You may not reverse engineer, decompile, or disassemble the Software. You may not nor permit others to copy or transfer the Software; distribute, sell, rent, loan, lease, sub-license or otherwise deal in the Software; alter, adapt, merge, modify or translate the Software in any way or for any purpose, including, without limitation, for error correction; remove, change or obscure any product identification or notices of proprietary rights and restrictions on or in the Software. Without prejudice to any other rights it may have, Digital Infuzion and its Customer may revoke your right to use the Software if you do not abide by the terms and conditions contained in this Section 20 (&quot;Software Use&quot;).\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Governing Law and Jurisdiction. </b> These Terms of Use shall be governed by the laws of the State of Maryland, United States, without regard to its conflicts of laws principles. Any legal action or proceeding related to the GNEM-DMP shall be brought exclusively in a court of competent jurisdiction sitting in Montgomery County, State of Maryland, United States.\r\n    </div>\r\n    </br>\r\n\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Severance. </b> If any provision of these Terms of Use is held to be unlawful, void or unenforceable, then such provision shall be severable without affecting the enforceability of all remaining provisions.\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>The GNEM-DMP Transferability. </b> Digital Infuzion and its Customer retain various technology partners to operate the GNEM-DMP system on its behalf. These include Digital Infuzion, Inc. who maintains secure hosting services. Digital Infuzion also reserves the right to sell, assign or otherwise transfer operation and control of the GNEM-DMP or any individual observational outcomes to a third party at some future point in time.\r\n    </div>\r\n    </br>\r\n\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Contact Details. </b> . If you are a Participating Medical Personnel or Secondary Care Personnel and have questions about your use of the GNEM-DMP, please write to us via email. If you are a participant, we recommend that you contact your treating physician who participates in the observational outcomes studies.\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b></b>\r\n    </div>\r\n    </br>\r\n","StatementTextTranslated":"\r\n    <h3>\r\n        GNEM-DMP TERMS OF USE\r\n    </h3>\r\n    <div class=\"EnrollmentContentTable\">\r\n        <div class=\"tdTopPadding tdButtomPadding\">\r\n            [Last Updated:  August 20, 2015]\r\n        </div>\r\n        <div class=\"tdTopPadding tdButtomPadding\">\r\n            Welcome to the GNEM-DMP (&quot;the GNEM-DMP Platform&quot;), the web platform operated and hosted by Digital Infuzion, Inc. (&quot;Digital Infuzion&quot;). The GNEM-DMP incorporates both a reporting portal and a data entry component. These Terms of Use govern the access to and use of the GNEM-DMP.\r\n        </div>\r\n        <div class=\"tdTopPadding tdButtomPadding\">\r\n            The GNEM-DMP is for use by physicians and authorized medical personnel (the &quot;Participating Medical Personnel&quot;) and participants (&quot;Participants&quot;) who take part in registries, observational studies, or health outcome studies sponsored by Digital Infuzion&apos;s customer (&quot;Customer&quot;), as well as members of secondary care teams that provide care for Participants (&quot;Secondary Care Personnel&quot;) (collectively, &quot;Users&quot;).\r\n        </div>\r\n        <div class=\"tdTopPadding tdButtomPadding\">\r\n            RegistryNXT! is restricted-access: in accordance with these Terms of Use, only Participating Medical Personnel who are approved by Genzyme, and Secondary Care Personnel and Participants who are invited by Participating Medical Personnel, may register to access and use RegistryNXT!.  Registration for and use of RegistryNXT! by Users is entirely voluntary.\r\n        </div>\r\n        The primary purpose of the GNEM-DMP is to facilitate, in accordance with the Customer&apos;s observational outcomes or other study protocols, Participating Medical Personnel to collect, submit, and view data in connection with these studies. Participating Medical Personnel will have the ability to view pre-defined, real-time reports from this data and to share such individual reports with Secondary Care Personnel and Participants. Each class of User has different rights in relation to the GNEM-DMP:\r\n    </div>\r\n\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        Participating Medical Personnel may enter data on the GNEM-DMP, review and query data stored on the GNEM-DMP, and generate reports from the GNEM-DMP;\r\n    </div>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        Secondary Care Personnel may review reports relating to Participants, but only if published and shared by Participating Medical Personnel; and Participants may review customized reports generated and shared by Participating Medical Personnel and may view a list of Observational outcomes members who are part of the Participating Medical Personnel&apos;s team.\r\n    </div>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        Accordingly, these Terms of Use are divided into sections applicable to different classes of User.\r\n    </div>\r\n\r\n    </br>\r\n    <div class=\"divStep4DisplayHeader\">\r\n        <b><u>Terms Regarding Use of the GNEM-DMP Applicable to All Users </u></b>\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Registration and Privacy.</b>  Information that you provide to Digital Infuzion and its Customer about yourself when registering to use the GNEM-DMP must be accurate and truthful, and you accept any and all liability for any inaccurate or untruthful information that you provide, except that Participants may register with a fictitious name (or alias) in order to protect their privacy. Note that Secondary Care Personnel and Participants will need a valid e-mail address in order to register, as invitations will be sent from Participating Medical Personnel via e-mail, which will contain a personalized link for the invitee to click on in order to register. Accordingly, Digital Infuzion, the primary technical provider, and its agents, will have access to the e-mail addresses for all Users for the purpose of assistance with passwords and for the sending of system notification updates. Digital Infuzion respects the privacy of all Users, and you should refer to the Digital Infuzion Privacy Policy applicable to the GNEM-DMP to learn more about the collection and use of your personal information.\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>User Account, Password and Security.</b>  All Users, regardless of role, must register and select a username, password, and a security question. You are entirely responsible for maintaining the confidentiality of your ID, password and account, and for taking precautions to prevent the inadvertent disclosure of your ID, password or account information. Furthermore, you should not share your user ID or password, even with other members of your staff or practice (for Participating Medical Personnel and Secondary Care Personnel) or with family members or friends (for all Users). For Participating Medical Personnel and Secondary Care Personnel, each member of your staff or practice will need to be separately registered in the GNEM-DMP and obtain his/her own user ID and password. You are entirely responsible for any and all activities that occur under your account. You agree to notify Digital Infuzion immediately of any unauthorized use of your account or any other breach of security. Digital Infuzion will not be liable for any loss that you may incur as a result of someone else using your ID, password or account, either with or without your knowledge. You may be held liable for any harm or loss (including legal fees) incurred by Digital Infuzion or another party due to someone else using your ID, password or account. Digital Infuzion and its customer may suspend or terminate your access to the GNEM-DMP if Digital Infuzion believes your account is being used by an unauthorized person or if you have not complied with these Terms of Use or for any other reason in Digital Infuzion&apos;s sole discretion. You may not use anyone else&apos;s account at any time, without the express permission of the account holder.\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>E-signatures. </b> In order to become authorized to use the GNEM-DMP, you may be asked to furnish information that constitutes an electronic signature. You accept that your electronic signature is legally binding and equivalent to your written signature.\r\n    </div>\r\n    </br>\r\n    <div class=\"divStep4DisplayHeader\">\r\n        <b><u>Terms Regarding Use Applicable to Participating Medical Personnel </u></b>\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        Information Entered into the GNEM-DMP by Participating Medical Personnel. You may only enter information into the GNEM-DMP that relates to the studies, and you accept any and all liability for any optional information that you enter, for example, care team contacts or report comments. You are prohibited from entering any information that may breach applicable laws, including any data protection or privacy laws; Sections 5 (&quot;Data Privacy and Data Protection&quot;) and 10 (&quot;Third Party Consents&quot;) of these Terms of Use set out your obligations in this regard in more detail.\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Third Party Consents.</b> You may enter into the GNEM-DMP personal information relating to a Participant only after securing the freely-given explicit consent of the Participant to do so. Please note, in some jurisdictions including potentially your own, observational outcomes identification numbers might constitute personal information under applicable laws. When obtaining such consents, you must comply with any requirements arising under their local data privacy, health or related laws. This includes obtaining the Participant&apos;s written consent and providing Participants with suitable informational disclosures concerning the processing of their data in connection with the GNEM-DMP. It is a misuse of the GNEM-DMP and a violation of these Terms of Use to enter information relating to a Participant who has not expressly consented to having their personal data processed in connection with the GNEM-DMP. You are solely responsible for any and all information entered by you regarding Participants, and in no event shall Digital Infuzion be liable for any loss, harm or damage arising from or related to your failure to obtain necessary consents from Participants to have information relating to them entered into or processed in connection with the GNEM-DMP.\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Responsibility for Secondary Care Personnel and Participant use of the GNEM-DMP.  </b>  As a Participating Medical Personnel, you have the ability at your discretion to invite Secondary Care Personnel and your Participants to register in the GNEM-DMP. Secondary Care Personnel and Participants will only have access to customized reports specifically created and designated by you. You are solely responsible for verifying the identity of such invitees and for the disclosure of the Participant data to Secondary Care Personnel and to the Participants themselves, including any liability related to the disclosure of such data to the extent disclosure is not permissible under local law. For system performance, Digital Infuzion and its Customer may monitor access to particular Participant data stored on the GNEM-DMP by user ID and may perform audits on such access.\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Exclusion of Liability. </b>  Any information and material entered by Participating Medical Personnel into the GNEM-DMP is done at your own discretion and risk and you will be solely responsible for any damage to your computer system or loss, temporary or permanent, of data that results from the input of any such information or material or otherwise from using the GNEM-DMP.\r\n    </div>\r\n    </br>\r\n    <div class=\"divStep4DisplayHeader\">\r\n        <b><u>Disclaimers, Exclusions and Other Important Terms Applicable to All Users </u></b>\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Disclaimer of Warranties. </b>  The GNEM-DMP is provided on an \"AS IS\" and \"AS AVAILABLE\" basis. You agree that your access to and use of the GNEM-DMP and the contents available therein is at your own risk.\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        Although Digital Infuzion will use reasonable efforts to ensure that the GNEM-DMP remains operational and accessible to Users, by registering for and using the GNEM-DMP you accept that Digital Infuzion makes no express or implied warranties or representations of any kind as to the accuracy, content, completeness, reliability, operability, or legality of information contained within the GNEM-DMP; or that the GNEM-DMP will meet your particular business requirements, needs or expectations; or that the GNEM-DMP will be uninterrupted, timely, error-free or continuously available; or that the GNEM-DMP will not cause you any loss, interruption of business, interruption of research or treatment, or any direct, indirect, special, incidental or consequential damages of any kind (including lost profits) regardless of the form of the action whether in contract or in tort (including negligence).\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Damages. </b>Any use that you make of information stored within the GNEM-DMP or generated in reports is done at your own discretion and risk. Neither Digital Infuzion, nor any party involved in creating, producing or delivering the GNEM-DMP, shall be liable for any damages, including without limitation, direct, indirect, special, incidental or consequential damages of any kind (including lost profits) regardless of the form of the action whether in contract or in tort (including negligence), arising out of access to, use of or inability to use the GNEM-DMP, or regarding any use of information stored within the GNEM-DMP or generated in reports.\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Non-Confidential Information. </b> Subject to any protections that might be extended under the Digital Infuzion Privacy Policy applicable to the GNEM-DMP, any communication that you send to Digital Infuzion via the Internet is and will be deemed to be non-confidential and Digital Infuzion shall have no obligation of any kind with respect to such information, except as contained in the applicable observational outcomes protocol. Digital Infuzion shall be free to use any ideas, concepts, know-how or techniques contained in such communication for any purpose whatsoever, including but not limited to, researching, developing, testing, manufacturing and marketing products.\r\n    </div>\r\n    </br>\r\n    <div class=\"divStep4DisplayHeader\">\r\n        <b><u>Disclaimers, Exclusions and Other Important Terms Applicable to All Users</u></b>\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Trademarks </b> All product names with or without the trademark symbol, are registered trademarks, trademarks or trade names of Digital Infuzion, its Customers, affiliates, related companies, licensors or joint venture partners, unless otherwise noted. The use of these trademarks or any other materials, except as permitted herein, is expressly prohibited and may be in violation of copyright law, trademark law or other proprietary rights of Digital Infuzion.\r\n    </div>\r\n    </br>\r\n\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Copyrights. </b> The contents of the GNEM-DMP are subject to copyright protection and all rights therein are reserved to Digital Infuzion. The contents of the GNEM-DMP may not be copied other than for non-commercial individual reference with all copyright or other proprietary notices retained, and thereafter may not be recopied, reproduced or otherwise redistributed except where necessary in connection with your professional activities and related research endeavours. Except as expressly provided above, you may not otherwise copy, display, download, distribute, modify, reproduce, republish or retransmit any information, text or documents or any portion thereof in any electronic medium or in hard copy, or create any derivative work based on such images, text or documents, without the express written consent of Digital Infuzion. Nothing contained herein shall be construed as conferring by implication, estoppel or otherwise any license or right under any patent or trademark of Digital Infuzion, or any third party.\r\n    </div>\r\n    </br>\r\n\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Void Where Prohibited. </b> The GNEM-DMP and its contents are intended to comply with the laws and regulations of the State of Maryland, United States. Other countries may have laws, regulatory requirements and medical practices that differ from those in the State of Maryland, United States. Digital Infuzion and its Customer reserve the right to limit use of the GNEM-DMP to any person, geographic region or jurisdiction.\r\n    </div>\r\n    </br>\r\n\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Third Party Web Sites. </b> The GNEM-DMP contains links to other World Wide Web sites and resources produced by Digital Infuzion and its Customers various operating divisions and affiliates, as well as independent third parties unaffiliated with Digital Infuzion. Such links are provided for your reference only. Digital Infuzion does not control such web sites, and is not responsible for their contents. Digital Infuzion&apos;s inclusion of links to such web sites does not imply any endorsement of the material on such web sites or any association with their operators, and your access and use of such web sites, including information, material, products and services therein, is solely at your own risk. Digital Infuzion makes no representation or warranty as to any third party content, products or services, and you agree that Digital Infuzion shall not be responsible or liable, directly or indirectly, for any damage or loss caused or alleged to be caused by or in connection with use of or reliance on any such third-party content, products or services available on or through any such site or resource. Once on another web site, you should read that web site&apos;s privacy policy before disclosing any personal information.\r\n    </div>\r\n    </br>\r\n\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Software Use. </b> Use of the GNEM-DMP may entail your installing, copying, downloading, accessing or otherwise using software products owned by or proprietary to Digital Infuzion or its licensors (the &quot;Software&quot;). Users are authorized to install, use, access, display or run the Software only in connection with their use of the GNEM-DMP, and for no other purpose. You may not reverse engineer, decompile, or disassemble the Software. You may not nor permit others to copy or transfer the Software; distribute, sell, rent, loan, lease, sub-license or otherwise deal in the Software; alter, adapt, merge, modify or translate the Software in any way or for any purpose, including, without limitation, for error correction; remove, change or obscure any product identification or notices of proprietary rights and restrictions on or in the Software. Without prejudice to any other rights it may have, Digital Infuzion and its Customer may revoke your right to use the Software if you do not abide by the terms and conditions contained in this Section 20 (&quot;Software Use&quot;).\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Governing Law and Jurisdiction. </b> These Terms of Use shall be governed by the laws of the State of Maryland, United States, without regard to its conflicts of laws principles. Any legal action or proceeding related to the GNEM-DMP shall be brought exclusively in a court of competent jurisdiction sitting in Montgomery County, State of Maryland, United States.\r\n    </div>\r\n    </br>\r\n\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Severance. </b> If any provision of these Terms of Use is held to be unlawful, void or unenforceable, then such provision shall be severable without affecting the enforceability of all remaining provisions.\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>The GNEM-DMP Transferability. </b> Digital Infuzion and its Customer retain various technology partners to operate the GNEM-DMP system on its behalf. These include Digital Infuzion, Inc. who maintains secure hosting services. Digital Infuzion also reserves the right to sell, assign or otherwise transfer operation and control of the GNEM-DMP or any individual observational outcomes to a third party at some future point in time.\r\n    </div>\r\n    </br>\r\n\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b>Contact Details. </b> . If you are a Participating Medical Personnel or Secondary Care Personnel and have questions about your use of the GNEM-DMP, please write to us via email. If you are a participant, we recommend that you contact your treating physician who participates in the observational outcomes studies.\r\n    </div>\r\n    </br>\r\n    <div class=\"tdTopPadding tdButtomPadding\">\r\n        <b></b>\r\n    </div>\r\n    </br>\r\n","StatementType":["Id":"cedd8b88-ab84-4b95-968c-36481578a803","CodeSetName":"LegalStatementTypeCode","CodeValue":"ParticipantTC","Description":"ParticipantTC"],"IsAccepted":true]]
        
        
    ]
    
    // Create the request
    let request = NSMutableURLRequest(URL:url)
    request.HTTPMethod = "POST"
    request.setValue("application/json; charset=utf-8", forHTTPHeaderField: "Content-Type")
    do {
        request.HTTPBody = try NSJSONSerialization.dataWithJSONObject(postParams, options: NSJSONWritingOptions())
        print(postParams)
    } catch {
        print("bad things happened")
    }
    
    // Make the POST call and handle it in a completion handler
    session.dataTaskWithRequest(request, completionHandler: { ( data: NSData?, response: NSURLResponse?, error: NSError?) -> Void in
        // Make sure we get an OK response
        guard let realResponse = response as? NSHTTPURLResponse where
            realResponse.statusCode == 200 else {
                print("Not a 200 response")
                return
        }
        
        // Read the JSON
        if let postString = NSString(data:data!, encoding: NSUTF8StringEncoding) as? String {
            // Print what we got from the call
            print("POST: " + postString)
            //                self.performSelectorOnMainThread("updatePostLabel:", withObject: postString, waitUntilDone: false)
        }
        
    }).resume()
    
}

//extension ConsentViewController : ORKTaskViewControllerDelegate {
//
//    func taskViewController(taskViewController: ORKTaskViewController, didFinishWithReason reason: ORKTaskViewControllerFinishReason, error: NSError?) {
//        //Handle results with taskViewController.result
//        taskViewController.dismissViewControllerAnimated(true, completion: nil)
//        performSegueWithIdentifier("consenttoregister", sender: nil)
//
//    }
//    
//}
}

extension ConsentViewController : ORKTaskViewControllerDelegate {
    
    func taskViewController(taskViewController: ORKTaskViewController, didFinishWithReason reason: ORKTaskViewControllerFinishReason, error: NSError?) {
        //Handle results with taskViewController.result
        
        switch reason {
        case .Completed:
            //Replace these strings the identifiers of your tasks.
            let consentstring = "ConsentTask"
            let badconsentstring = "BadConsentSurveyTask"
            let lateconsentstring = "ConsentLateTask"
            let tryagaintermsstring = "TryAgainTerms"
            
            
            taskViewController.dismissViewControllerAnimated(true, completion: nil)
            
            
            //Finished Consent Step
            if taskViewController.result.description.rangeOfString(consentstring) != nil {
                
                //Get Role
   
                //Get Quiz Answer
                var qanswer = taskViewController.result.stepResultForStepIdentifier("QuizChoiceQuestionStep")?.description.characters.split{$0 == "("}.map(String.init);
                //Right Answer (2)
                if(qanswer![qanswer!.count-1].rangeOfString("2") != nil){
                    let taskViewController = ORKTaskViewController(task: GnemLateConsent, taskRunUUID: nil)
                    taskViewController.delegate = self
                    presentViewController(taskViewController, animated: true, completion: nil)
                }else{
                    //Wrong Answer
                    let taskViewController = ORKTaskViewController(task: BadConsentSurveyTask, taskRunUUID: nil)
                    taskViewController.delegate = self
                    presentViewController(taskViewController, animated: true, completion: nil)
                }
                
            }
                
                //Finished bad consent(Prompts you that you were wrong.  Brings you back to question.
            else if taskViewController.result.description.rangeOfString(badconsentstring) != nil {
                
                let taskViewController = ORKTaskViewController(task: TryAgainTerms, taskRunUUID: nil)
                taskViewController.delegate = self
                presentViewController(taskViewController, animated: true, completion: nil)
                
                
            }
                //Finished Final Consent.  Answered Question right, registered for account
            else if taskViewController.result.description.rangeOfString(lateconsentstring) != nil {
                
                //Filter out the Informed consent Results
                var register = taskViewController.result.stepResultForStepIdentifier("RegisterSurveyTask")?.description.characters.split{$0 == "("}.map(String.init);
                //Filter out Excessive text
                var parser = register!.description.characters.split{$0 == "<"}.map(String.init);
                
                //Get Username
                var usernameparser1 = parser[2].characters.split{$0 == ":"}.map(String.init)
                var usernameparser2 = usernameparser1[3].characters.split{$0 == ">"}.map(String.init)
                username = usernameparser2[0].stringByTrimmingCharactersInSet(NSCharacterSet.whitespaceCharacterSet())
                
                //Get Password
                var passparser1 = parser[3].characters.split{$0 == ":"}.map(String.init)
                var passparser2 = passparser1[3].characters.split{$0 == ">"}.map(String.init)
                pass = passparser2[0].stringByTrimmingCharactersInSet(NSCharacterSet.whitespaceCharacterSet())
                
                //Get Email
                var emailparser1 = parser[4].characters.split{$0 == ":"}.map(String.init)
                var emailparser2 = emailparser1[3].characters.split{$0 == ">"}.map(String.init)
                email = emailparser2[0].stringByTrimmingCharactersInSet(NSCharacterSet.whitespaceCharacterSet())
                
                print(username)
                print(pass)
                print(email)
                //Register With Ultragenyx
                postDataToURL()
                
                //Rout to Ultragenyx Website
                UIApplication.sharedApplication().openURL(NSURL(string: "https://ultragenyx-qa.nof1health.com")!)
                
                
                
                
            }
                //After the user has failed to answer the question the first time, they are prompted to answer again
            else if taskViewController.result.description.rangeOfString(tryagaintermsstring) != nil {
                var parser = taskViewController.result.results!.description.characters.split{$0 == "\n"}.map(String.init);
                //Right Answer!
                if parser[parser.count - 3].rangeOfString("2") != nil{
                    let taskViewController = ORKTaskViewController(task: GnemLateConsent, taskRunUUID: nil)
                    taskViewController.delegate = self
                    presentViewController(taskViewController, animated: true, completion: nil)
                    
                }
                    //Wrong Answer :(
                else{
                    let taskViewController = ORKTaskViewController(task: BadConsentSurveyTask, taskRunUUID: nil)
                    taskViewController.delegate = self
                    presentViewController(taskViewController, animated: true, completion: nil)
                    
                }
            }
            
        //Canceled or Exited before finish.
        case .Discarded, .Failed, .Saved:
            taskViewController.dismissViewControllerAnimated(true, completion: nil)
            canceled = true;
            performSegueWithIdentifier("consenttosurvey", sender: nil)

            
            
        }
        
    }
}
